# ガントチャートV3 要件分析書

## 概要

このドキュメントは、既存のガントチャート機能（GanttV2）を拡張し、プロジェクト管理機能を強化した新しいガントチャート（GanttV3）の要件分析結果をまとめたものです。

## 現在の実装状況分析

### 優れている機能

#### 1. 柔軟な期間管理システム
- **基準期間（KIJUN）**: ベースライン計画
- **予定期間（YOTEI）**: 現在の計画
- **実績期間（JISSEKI）**: 実際の作業期間
- 各期間タイプごとの工数管理が可能

#### 2. 豊富な集計・分析機能
- **フェーズ別集計**: 工程ごとの進捗・工数集計
- **担当者別集計**: 個人の作業負荷状況
- **月別集計**: 時系列での作業量分析
- **進捗履歴**: 自動・手動スナップショット機能

#### 3. 直感的なユーザーインターface
- **ドラッグ&ドロップ**: タスクの移動・期間変更
- **リサイズ操作**: タスク期間の調整
- **視覚的フィードバック**: ステータス別色分け、ホバーエフェクト
- **複数表示モード**: 日・週・月単位の表示切替

#### 4. 高度なデータ管理
- **進捗履歴管理**: 変更の時系列追跡
- **マイルストーン管理**: 重要な節目の管理
- **グループ化**: フェーズ別・担当者別表示

### 不足している機能

#### 1. タスク依存関係管理 ❌
**現状**: タスク間の依存関係を管理するテーブル・機能が存在しない

**問題点**:
- プロジェクトスケジュールの論理的整合性が保てない
- 先行タスクの遅延が後続タスクに自動反映されない
- クリティカルパスの特定ができない

**必要な機能**:
- FS（完了-開始）、SS（開始-開始）、FF（完了-完了）、SF（開始-完了）の4種類の依存関係
- 依存関係の視覚的表示（矢印）
- 循環依存の検証・防止

#### 2. クリティカルパス分析 ❌
**現状**: CPM（Critical Path Method）による分析機能が未実装

**問題点**:
- プロジェクト完了に最も影響するタスクが特定できない
- スケジュール遅延のリスク評価ができない
- リソースの優先度付けが困難

**必要な機能**:
- CPMアルゴリズムによる最長経路計算
- クリティカルタスクのハイライト表示
- フロート時間（余裕時間）の計算・表示

#### 3. 自動スケジューリング ❌
**現状**: 手動でのタスク日程調整のみ

**問題点**:
- 依存関係を考慮した自動調整ができない
- 制約条件の違反を防げない
- 大規模プロジェクトでの管理が困難

**必要な機能**:
- 依存関係に基づく自動日程調整
- 制約条件の検証・警告
- ユーザー手動変更の保護オプション

#### 4. リソース管理の強化 ⚠️
**現状**: 基本的な担当者割り当てのみ

**問題点**:
- 担当者の稼働可能時間が考慮されない
- リソースのオーバーブッキングを検知できない
- 負荷平準化の提案ができない

**必要な機能**:
- 担当者の稼働可能時間設定
- リソース競合の検知・警告
- 負荷平準化の自動提案

## 技術的分析

### データベーススキーマ分析

#### 現在のスキーマの特徴
- **WBS構造**: プロジェクト→フェーズ→タスクの階層構造
- **期間管理**: TaskPeriodテーブルによる複数期間タイプ管理
- **進捗追跡**: WbsProgressHistory、TaskProgressHistoryによる履歴管理

#### 不足しているテーブル
```sql
-- 依存関係管理テーブル（未実装）
TaskDependency {
  predecessorId: 先行タスク
  successorId: 後続タスク
  dependencyType: 依存関係タイプ
  lagDays: 遅延日数
}

-- リソース管理テーブル（未実装）
UserCapacity {
  userId: ユーザーID
  date: 日付
  availableHours: 稼働可能時間
}
```

### コンポーネント分析

#### 現在のGanttV2の構成
```
GanttV2/
├── gantt-v2.tsx           # メインコンテナ
├── gantt-chart.tsx        # チャート表示
├── gantt-task-row.tsx     # タスク行表示
└── gantt-timeline.tsx     # タイムライン
```

#### 不足している機能コンポーネント
- 依存関係矢印表示コンポーネント
- クリティカルパス表示コンポーネント
- リソース表示コンポーネント
- 自動スケジューリング管理コンポーネント

## 改善要件

### 機能要件

#### FR-001: タスク依存関係管理
- **優先度**: 必須
- **概要**: タスク間の依存関係を作成・編集・削除する機能
- **詳細**:
  - 4種類の依存関係タイプ（FS, SS, FF, SF）
  - ドラッグ&ドロップによる依存関係作成
  - 依存関係の視覚的表示（矢印）
  - 循環依存の検証・防止

#### FR-002: クリティカルパス分析
- **優先度**: 必須
- **概要**: CPMによるクリティカルパスの自動計算・表示
- **詳細**:
  - 最長経路の自動計算
  - クリティカルタスクのハイライト
  - フロート時間の表示
  - パス変更の動的更新

#### FR-003: 自動スケジューリング
- **優先度**: 必須
- **概要**: 依存関係に基づく自動日程調整
- **詳細**:
  - 先行タスク変更時の後続タスク自動調整
  - 制約条件の検証
  - 手動変更の保護オプション

#### FR-004: リソース管理強化
- **優先度**: 重要
- **概要**: 担当者の稼働状況管理・競合検知
- **詳細**:
  - 稼働可能時間設定
  - オーバーブッキング警告
  - リソース利用率表示

#### FR-005: 高度な表示機能
- **優先度**: 重要
- **概要**: 進捗・リソース状況の視覚化
- **詳細**:
  - 進捗バー表示
  - リソース負荷状況表示
  - カスタム色分けテーマ

### 非機能要件

#### NFR-001: パフォーマンス
- 1000タスク以上での滑らかな動作
- レスポンス時間2秒以内
- メモリ使用量100MB未満

#### NFR-002: ユーザビリティ
- 既存操作の学習コストゼロ
- 直感的な新機能操作
- エラー発生率20%削減

#### NFR-003: 互換性
- 既存データの完全移行
- GanttV2からのスムーズな移行
- 既存APIとの互換性維持

## ユーザーストーリー

### US-001: プロジェクトマネージャーとしての依存関係管理
```
As a プロジェクトマネージャー
I want タスク間の依存関係を設定できる
So that プロジェクトの論理的な順序を管理できる
```

**受け入れ基準**:
- [ ] タスクAの完了後にタスクBが開始される依存関係を設定できる
- [ ] 依存関係が矢印で視覚的に表示される
- [ ] 循環依存を作成しようとすると警告が表示される

### US-002: プロジェクトマネージャーとしてのクリティカルパス確認
```
As a プロジェクトマネージャー
I want クリティカルパスを確認できる
So that プロジェクト遅延のリスクを把握できる
```

**受け入れ基準**:
- [ ] クリティカルパス上のタスクが赤色でハイライトされる
- [ ] 各タスクのフロート時間が表示される
- [ ] クリティカルパス上のタスク遅延時にアラートが表示される

### US-003: リソースマネージャーとしての負荷確認
```
As a リソースマネージャー
I want 担当者の作業負荷を確認できる
So that リソースの最適配分ができる
```

**受け入れ基準**:
- [ ] 担当者別の稼働率がパーセンテージで表示される
- [ ] オーバーブッキング時に警告が表示される
- [ ] 負荷平準化の提案が表示される

## 制約条件

### 技術制約
- Next.js 15 + TypeScript環境での実装
- 既存のPrismaスキーマとの互換性維持
- クリーンアーキテクチャパターンの継承

### 業務制約
- 既存データの完全移行必須
- ユーザートレーニング時間の最小化
- 段階的リリースによるリスク軽減

### スケジュール制約
- 8-12週間での実装完了
- フェーズ1（基盤）は3週間以内
- MVP機能は6週間以内

## 成功基準

### 機能成功基準
- [ ] 依存関係作成の成功率90%以上
- [ ] クリティカルパス計算の精度100%
- [ ] 自動スケジューリングの応答時間2秒以内
- [ ] リソース競合検知の精度95%以上

### パフォーマンス成功基準
- [ ] 1000タスクでの初期表示1秒以内
- [ ] タスク移動操作の応答性200ms以内
- [ ] メモリ使用量の現状維持（100MB未満）

### ユーザビリティ成功基準
- [ ] 既存ユーザーの移行成功率90%以上
- [ ] 新機能の操作成功率（初回）70%以上
- [ ] ユーザーサポート問い合わせ20%削減

---

**文書作成日**: 2025-08-08  
**作成者**: Claude Code  
**文書バージョン**: 1.0