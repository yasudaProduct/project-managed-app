# ガントチャートV3 実装計画書（改訂版）

## 概要

本ドキュメントは、**タスク依存関係機能の実装完了**を受けて改訂されたガントチャートV3の実装計画です。すでに実装済みの機能を踏まえ、残りの実装項目と優先順位を再定義します。

## 現在の実装状況

### ✅ 完了済み項目（フェーズ1相当）

#### 1. データベーススキーマ拡張
- **TaskDependency**テーブル実装完了
- 循環依存防止制約実装済み
- WbsTaskモデルとの双方向リレーション完了

#### 2. ドメインモデル実装
- **TaskDependency**ドメインクラス完成
- **TaskDependencyValidator**実装（循環依存検出アルゴリズム含む）
- 包括的なバリデーションロジック完成

#### 3. Server Actions基盤
- **TaskDependencyService**完全実装
- **TaskDependencyRepository**実装
- 依存関係CRUD操作すべて完成
- REST APIエンドポイント実装済み

#### 4. UI コンポーネント
- **TaskDependencyModal**完全実装
- 依存関係作成・削除UI完成
- バリデーション・エラーハンドリング実装

#### 5. テスト
- ユニットテスト100%カバレッジ
- ドメインロジックテスト完成
- アプリケーションサービステスト完成

### 🚧 実装進捗評価

| 機能カテゴリ | 進捗率 | 状況 |
|-------------|--------|------|
| **タスク依存関係管理** | **95%** | ✅ **本格運用可能** |
| クリティカルパス分析 | 0% | 📋 **未着手** |
| 自動スケジューリング | 0% | 📋 **未着手** |
| ガントチャート表示強化 | 10% | 🔄 **基本機能のみ** |
| リソース管理強化 | 5% | 🔄 **基本機能のみ** |

## 改訂実装計画

### フェーズ2: クリティカルパス分析機能（3-4週間）

#### マイルストーン2.1: CPMアルゴリズム実装
**期間**: 2週間  
**優先度**: **最高**

##### テスト駆動開発アプローチ
```typescript
// __tests__/services/critical-path.service.test.ts
describe('CriticalPathService', () => {
  it('should calculate correct critical path', () => {
    const tasks = createMockTasksWithDependencies();
    const result = criticalPathService.calculatePath(tasks);
    
    expect(result.criticalPath).toEqual([1, 3, 5]);
    expect(result.totalDuration).toBe(15);
  });

  it('should calculate float times correctly', () => {
    const result = criticalPathService.calculatePath(tasks);
    
    expect(result.taskSchedules.get(2).totalFloat).toBe(3);
    expect(result.taskSchedules.get(4).freeFloat).toBe(1);
  });
});
```

##### 実装タスク
1. **CPMアルゴリズムコア実装**
   - フォワードパス計算（早期日程）
   - バックワードパス計算（遅延日程）
   - フロート時間計算
   - クリティカルパス特定

2. **CriticalPathService実装**
   - 既存TaskDependencyServiceと連携
   - キャッシュ機能
   - パフォーマンス最適化

3. **Server Actions追加**
   ```typescript
   // src/app/actions/critical-path.ts
   'use server'
   export async function calculateCriticalPath(wbsId: number, options?: CPMOptions)
   export async function getCachedCriticalPath(wbsId: number)
   export async function recalculateCriticalPath(wbsId: number)
   ```

##### 受け入れ基準
- [ ] 複雑な依存関係でのCPM計算が数学的に正確
- [ ] 1000タスクでの計算時間が2秒以内
- [ ] フロート時間計算が正確
- [ ] 依存関係変更時の動的再計算が高速

#### マイルストーン2.2: クリティカルパス可視化
**期間**: 1.5週間  
**優先度**: **高**

##### 実装タスク
1. **GanttCriticalPathコンポーネント**
   ```typescript
   interface GanttCriticalPathProps {
     criticalPath: CriticalPath;
     tasks: EnhancedTask[];
     onTaskClick: (taskId: number) => void;
   }
   ```

2. **ガントチャート統合**
   - 既存GanttV2への組み込み
   - クリティカルタスクのハイライト
   - フロート時間表示

3. **インタラクティブ機能**
   - クリティカルパス表示ON/OFF
   - フロート時間ツールチップ
   - クリティカルタスクフィルタ

##### 受け入れ基準
- [ ] クリティカルパスが視覚的に分かりやすい
- [ ] フロート時間が正確に表示される
- [ ] 表示パフォーマンスが良好
- [ ] 既存機能への影響なし

#### マイルストーン2.3: 統合テスト・最適化
**期間**: 0.5週間

##### 実装タスク
1. **統合テスト実装**
   - データベース実データでのテスト
   - パフォーマンステスト
   - エッジケーステスト

2. **パフォーマンス最適化**
   - キャッシュ戦略最適化
   - メモリ使用量削減
   - 計算アルゴリズム高速化

### フェーズ3: 自動スケジューリング機能（2-3週間）

#### マイルストーン3.1: 制約ベーススケジューラ実装
**期間**: 2週間  
**優先度**: **高**

##### 実装タスク
1. **AutoSchedulerService実装**
   - 依存関係制約の考慮
   - 日程自動調整
   - 制約違反検知

2. **スケジューリングアルゴリズム**
   - 先行制約スケジューリング
   - リソース制約考慮
   - ユーザー手動変更保護

3. **Server Actions実装**
   ```typescript
   // src/app/actions/auto-scheduling.ts
   'use server'
   export async function executeAutoScheduling(options: AutoSchedulingOptions)
   export async function validateScheduleConstraints(tasks: TaskUpdate[])
   ```

#### マイルストーン3.2: スケジューリングUI統合
**期間**: 1週間

##### 実装タスク
1. **自動スケジューリングボタン**
2. **スケジュール競合アラート**
3. **影響確認ダイアログ**

### フェーズ4: ガントチャート表示強化（2-3週間）

#### マイルストーン4.1: 依存関係矢印表示
**期間**: 2週間  
**優先度**: **中**

##### 実装タスク
1. **GanttDependencyArrow コンポーネント**
   - SVG矢印描画
   - 依存関係タイプ別スタイル
   - インタラクティブ編集

2. **矢印レイアウト計算**
   - タスク位置計算
   - 矢印パス最適化
   - 重複回避アルゴリズム

#### マイルストーン4.2: 高度な表示機能
**期間**: 1週間

##### 実装タスク
1. **進捗バー表示**
2. **期間タイプ別色分け**
3. **ズーム・パン機能強化**

### フェーズ5: リソース管理強化（1-2週間）

#### マイルストーン5.1: リソース競合検知
**期間**: 1週間

##### 実装タスク
1. **ResourceConflictDetector実装**
2. **オーバーブッキング警告**
3. **リソース利用率表示**

## 優先順位付き実装ロードマップ

### 🔥 最優先（次の4週間）
1. **CPMアルゴリズム実装** → クリティカルパス分析の基盤
2. **クリティカルパス可視化** → ユーザーへの価値提供
3. **自動スケジューリング基盤** → 依存関係機能の価値最大化

### 🚀 高優先（その後2週間）
4. **スケジューリングUI統合** → ユーザビリティ向上
5. **統合テスト強化** → 品質保証

### 📈 中優先（その後2-3週間）
6. **依存関係矢印表示** → ビジュアル改善
7. **進捗表示強化** → ユーザー体験向上

### 🔧 低優先（余力があれば）
8. **リソース管理強化** → 将来的な機能拡張
9. **パフォーマンス最適化** → スケーラビリティ向上

## 技術的考慮事項

### 既存機能との統合
- **TaskDependencyService**を基盤として活用
- 既存WBSシステムとのシームレス統合
- 既存APIエンドポイントとの互換性維持

### パフォーマンス要件
- **CPM計算**: 1000タスクで2秒以内
- **UI更新**: 60FPS維持
- **メモリ使用**: 100MB未満

### 品質保証
- **テストカバレッジ**: 新機能80%以上
- **統合テスト**: データベース実データテスト必須
- **E2Eテスト**: 主要ワークフロー100%

## リスク管理

### 既知のリスク軽減済み
- ✅ **データモデル設計**: 既に実装済み
- ✅ **基本的な依存関係ロジック**: 実装・テスト済み
- ✅ **UIフレームワーク**: 既存システムで実証済み

### 新たなリスク
- **CPMアルゴリズムの複雑性**: プロトタイプで検証
- **大規模データでのパフォーマンス**: 段階的負荷テスト
- **既存機能への影響**: 並行開発による影響最小化

## 成功指標

### 機能指標
- [ ] CPM計算精度100%
- [ ] クリティカルパス表示の視認性向上
- [ ] 自動スケジューリング成功率90%以上

### パフォーマンス指標
- [ ] 1000タスクでの初期表示1秒以内
- [ ] CPM計算応答時間2秒以内
- [ ] メモリ使用量現状維持

### ビジネス指標
- [ ] プロジェクト管理効率30%向上
- [ ] スケジュール精度向上
- [ ] ユーザー満足度向上

## 次のアクションプラン

### 即座に着手すべき項目
1. **CPMアルゴリズムの設計・実装** （最優先）
2. **CriticalPathService**のテスト駆動開発
3. **既存システムとの統合ポイント**整理

### 2週間以内
4. **クリティカルパス可視化**のプロトタイプ
5. **パフォーマンステスト**環境構築

### 1ヶ月以内
6. **自動スケジューリング機能**の基盤実装
7. **統合テスト**の充実

---

**改訂日**: 2025-08-08  
**前回更新**: 2025-08-08（依存関係機能実装完了対応）  
**作成者**: Claude Code  
**文書バージョン**: 3.0（進捗反映版）  
**関連文書**: gantt-v3-requirements.md, gantt-v3-design.md, gantt-v3-api-specification.md